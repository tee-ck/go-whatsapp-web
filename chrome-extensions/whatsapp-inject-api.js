(()=>{var $=Object.create;var E=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var Q=Object.getOwnPropertyNames;var Y=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty;var ee=r=>E(r,"__esModule",{value:!0});var te=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),A=(r,t)=>{for(var n in t)E(r,n,{get:t[n],enumerable:!0})},ne=(r,t,n,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Q(t))!z.call(r,s)&&(n||s!=="default")&&E(r,s,{get:()=>t[s],enumerable:!(e=J(t,s))||e.enumerable});return r},re=(r,t)=>ne(ee(E(r!=null?$(Y(r)):{},"default",!t&&r&&r.__esModule?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);var B=te((_e,N)=>{"use strict";var h=typeof Reflect=="object"?Reflect:null,S=h&&typeof h.apply=="function"?h.apply:function(t,n,e){return Function.prototype.apply.call(t,n,e)},_;h&&typeof h.ownKeys=="function"?_=h.ownKeys:Object.getOwnPropertySymbols?_=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:_=function(t){return Object.getOwnPropertyNames(t)};function se(r){console&&console.warn&&console.warn(r)}var P=Number.isNaN||function(t){return t!==t};function u(){u.init.call(this)}N.exports=u;N.exports.once=ue;u.EventEmitter=u;u.prototype._events=void 0;u.prototype._eventsCount=0;u.prototype._maxListeners=void 0;var D=10;function v(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return D},set:function(r){if(typeof r!="number"||r<0||P(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");D=r}});u.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};u.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||P(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function M(r){return r._maxListeners===void 0?u.defaultMaxListeners:r._maxListeners}u.prototype.getMaxListeners=function(){return M(this)};u.prototype.emit=function(t){for(var n=[],e=1;e<arguments.length;e++)n.push(arguments[e]);var s=t==="error",i=this._events;if(i!==void 0)s=s&&i.error===void 0;else if(!s)return!1;if(s){var a;if(n.length>0&&(a=n[0]),a instanceof Error)throw a;var c=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw c.context=a,c}var p=i[t];if(p===void 0)return!1;if(typeof p=="function")S(p,this,n);else for(var d=p.length,y=k(p,d),e=0;e<d;++e)S(y[e],this,n);return!0};function x(r,t,n,e){var s,i,a;if(v(n),i=r._events,i===void 0?(i=r._events=Object.create(null),r._eventsCount=0):(i.newListener!==void 0&&(r.emit("newListener",t,n.listener?n.listener:n),i=r._events),a=i[t]),a===void 0)a=i[t]=n,++r._eventsCount;else if(typeof a=="function"?a=i[t]=e?[n,a]:[a,n]:e?a.unshift(n):a.push(n),s=M(r),s>0&&a.length>s&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=r,c.type=t,c.count=a.length,se(c)}return r}u.prototype.addListener=function(t,n){return x(this,t,n,!1)};u.prototype.on=u.prototype.addListener;u.prototype.prependListener=function(t,n){return x(this,t,n,!0)};function ie(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function R(r,t,n){var e={fired:!1,wrapFn:void 0,target:r,type:t,listener:n},s=ie.bind(e);return s.listener=n,e.wrapFn=s,s}u.prototype.once=function(t,n){return v(n),this.on(t,R(this,t,n)),this};u.prototype.prependOnceListener=function(t,n){return v(n),this.prependListener(t,R(this,t,n)),this};u.prototype.removeListener=function(t,n){var e,s,i,a,c;if(v(n),s=this._events,s===void 0)return this;if(e=s[t],e===void 0)return this;if(e===n||e.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete s[t],s.removeListener&&this.emit("removeListener",t,e.listener||n));else if(typeof e!="function"){for(i=-1,a=e.length-1;a>=0;a--)if(e[a]===n||e[a].listener===n){c=e[a].listener,i=a;break}if(i<0)return this;i===0?e.shift():ae(e,i),e.length===1&&(s[t]=e[0]),s.removeListener!==void 0&&this.emit("removeListener",t,c||n)}return this};u.prototype.off=u.prototype.removeListener;u.prototype.removeAllListeners=function(t){var n,e,s;if(e=this._events,e===void 0)return this;if(e.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):e[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete e[t]),this;if(arguments.length===0){var i=Object.keys(e),a;for(s=0;s<i.length;++s)a=i[s],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=e[t],typeof n=="function")this.removeListener(t,n);else if(n!==void 0)for(s=n.length-1;s>=0;s--)this.removeListener(t,n[s]);return this};function U(r,t,n){var e=r._events;if(e===void 0)return[];var s=e[t];return s===void 0?[]:typeof s=="function"?n?[s.listener||s]:[s]:n?oe(s):k(s,s.length)}u.prototype.listeners=function(t){return U(this,t,!0)};u.prototype.rawListeners=function(t){return U(this,t,!1)};u.listenerCount=function(r,t){return typeof r.listenerCount=="function"?r.listenerCount(t):W.call(r,t)};u.prototype.listenerCount=W;function W(r){var t=this._events;if(t!==void 0){var n=t[r];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}u.prototype.eventNames=function(){return this._eventsCount>0?_(this._events):[]};function k(r,t){for(var n=new Array(t),e=0;e<t;++e)n[e]=r[e];return n}function ae(r,t){for(;t+1<r.length;t++)r[t]=r[t+1];r.pop()}function oe(r){for(var t=new Array(r.length),n=0;n<t.length;++n)t[n]=r[n].listener||r[n];return t}function ue(r,t){return new Promise(function(n,e){function s(a){r.removeListener(t,i),e(a)}function i(){typeof r.removeListener=="function"&&r.removeListener("error",s),n([].slice.call(arguments))}q(r,t,i,{once:!0}),t!=="error"&&le(r,s,{once:!0})})}function le(r,t,n){typeof r.on=="function"&&q(r,"error",t,n)}function q(r,t,n,e){if(typeof r.on=="function")e.once?r.once(t,n):r.on(t,n);else if(typeof r.addEventListener=="function")r.addEventListener(t,function s(i){e.once&&r.removeEventListener(t,s),n(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}});var X=re(B(),1);var g={};A(g,{get_qr:()=>he,is_beta:()=>w,is_chat_page:()=>de,is_landing_page:()=>pe,is_loading:()=>F,refresh_qr:()=>j,until_loaded:()=>L});var C={};A(C,{base64_to_file:()=>O,blob_to_base64:()=>fe,response:()=>o,sleep:()=>m,timeout:()=>ce});function o(r,t,n,e){return{status:r,flag:t,message:n,data:e}}async function m(r,t){await new Promise(n=>setTimeout(()=>n(t),r))}async function ce(r){throw await setTimeout(null,r),new Error("")}async function O(r,t,n){let e=window.atob(t),s=new Uint8Array(e.length);for(let i=0,a=e.length;i<a;i++)s[i]=e.charCodeAt(i);return new File([s],n||`${new Date().getTime()}.${r}`,{type:r})}async function fe(r){let t=new FileReader;return new Promise(n=>{t.onload=()=>n(t.result.toString()),t.readAsDataURL(r)})}var l={UNEXPECTED:"UNEXPECTED_ERROR",INVALID_PHONE:"INVALID_PHONE",CONNECTION_LOST:"CONNECTION_LOST",UNAUTHORIZED:"UNAUTHORIZED",PAGE_LOAD_FAILED:"PAGE_LOAD_FAILED",ZERO_OBJECT_SIZE:"ZERO_OBJECT_SIZE",REQUEST_TIMEOUT:"REQUEST_TIMEOUT"};var T={CONNECTED:"CONNECTED",DISCONNECTED:"DISCONNECTED",RESUMING:"RESUMING",SYNCING:"SYNCING"};function w(){return!!document.evaluate('//*[text()="BETA"]',document,null,XPathResult.ANY_TYPE,null).iterateNext()}function F(){return!!document.querySelector("progress")||!!document.querySelector("#initial_startup")||!!document.querySelector("#startup")}async function L(r=100,t=3e4){let n=new Date().getTime();for(;;){if(!F())return o(200,"");if(t>0&&new Date().getTime()-n>t)return o(400,l.PAGE_LOAD_FAILED);await m(r)}}function pe(){return!!document.querySelector(".landing-wrapper")}function de(){return!!document.querySelector("#pane-side")}function he(){return j(),document.querySelector("div[data-ref]")?.getAttribute("data-ref")}function j(){let r=document.querySelector("div[data-ref]")?.querySelector("button");r&&r.click()}async function I(){let r=await ye();return me(r)}function ye(){return new Promise(r=>{let t=new Date().getTime();window.webpackChunkwhatsapp_web_client.push([[`parasite ${t}`],{},(n,e,s)=>{let i=[];for(let a in n.m){let c=n(a);i.push(c)}r(i)}])})}function me(r){let t={},n={GK:e=>e.FEATURE_CHANGE_EVENT?e:null,Store:e=>e?.default?.Chat&&e?.default?.Msg?e.default:null,MediaCollection:e=>e?.default?.prototype?.processAttachments?e.default:null,MediaProcess:e=>e?.BLOB?e:null,Wap:e=>e?.createGroup?e:null,ServiceWorker:e=>e?.default?.killServiceWorker?e.default:null,WapDelete:e=>e?.sendCoversationDelete&&e?.SendConcersationDelete?.length>2?e:null,Conn:e=>e?.default?.ref&&e?.default?.refTTL?e:null,WapQuery:e=>e?.queryExist?e:e?.default?.queryExist?e.default:null,CryptoLib:e=>e?.decryptE2EMedia?e:null,OpenChat:e=>e?.default?.prototype?.openChat?e.default.prototype.openChat:null,UserConstructor:e=>e?.default?.prototype?.isServer?e.default:null,SendTextMsgToChat:e=>e?.sendTextMsgToChat?e.sendTextMsgToChat:null,SendMsgToChat:e=>e?.addAndSendMsgToChat?e:null,RandomID:e=>e?.randomId?e.randomId:null,MsgKey:e=>e?.default?.fromString?e.default:null,SendSeen:e=>e?.sendSeen?e:null,SendClear:e=>e?.sendClear?e:null,SendDelete:e=>e?.sendDelete?e:null,SendJoinGroupViaInvite:e=>e?.sendJoinGroupViaInvite?e:null,MediaPrep:e=>e?.MediaPrep?e:null,MediaObject:e=>e?.getOrCreateMediaObject?e:null,MediaUpload:e=>e?.uploadMedia?e:null,NumberInfo:e=>e?.formattedPhoneNumber?e:null,USyncUser:e=>e?.USyncUser?e.USyncUser:null,USyncQuery:e=>e?.USyncQuery?e.USyncQuery:null,Cmd:e=>e?.Cmd?e:null,MediaTypes:e=>e?.msgToMediaType?e:null,Validators:e=>e?.findLinks?e:null,WidFactory:e=>e?.createWid?e:null,BlockContact:e=>e?.blockContact?e:null,GroupMetadata:e=>e?.default?.handlePendingInvite?e.default:null,Sticker:e=>e?.default?.Sticker?e:null,UploadUtils:e=>e?.default?.encryptAndUpload?e.default:null,Label:e=>e?.LabelCollection?e:null,VCard:e=>e?.vcardFromContactModel?e:null,AppConst:e=>e?.default?.ACK?e.default:null,AppState:e=>e?.STREAM?e:null};for(let e of r)if(!(typeof e!="object"||!e)){if(!Object.keys(n).length)break;Object.entries(n).map(([s,i])=>{let a=i(e);a&&(window.wapi[s]=a,t[s]=a,delete n[s])})}return t}var G=class{core=null;is_connected=!1;on_initiated;constructor(){console.log("initializing"),this.core?this.on_initiated&&this.on_initiated():L(100).then(this.on_initiated).catch(()=>{}),this.init().then()}async init(){this.core=await I(),this.core.AppState.Socket.on("change:state",async t=>{console.log(`state changed: ${t.state}`)}),this.core.AppState.Socket.on("change:stream",async t=>{switch(console.log(`stream changed: ${t.stream}`),t.stream){case T.CONNECTED:this.is_connected=!0,this.core=await I();break;case T.DISCONNECTED:this.is_connected=!1;break;default:break}})}is_beta(){return!!this.core?.Features?.GK?.features?.MD_BACKEND}async query_user(t){try{if(this.is_beta()||w()){let n=new this.core.USyncQuery().withContactProtocol();n=n.withUser(new this.core.USyncUser().withPhone("+"+t));let e=await n.execute();if(console.log(e),e.list[0].id)switch(e.list[0].contact.type){case"in":return o(200,"","[query user success]",e.list[0].id);case"out":return o(404,l.INVALID_PHONE,`[query user error][invalid phone]: ${t}`);default:break}return o(500,l.UNEXPECTED,"[query user error]")}else{let n=await this.core.WapQuery.queryExists(t+"@c.us");switch(n.status){case 200:return o(200,"","[query user success]",n.jid);case 404:return o(404,l.INVALID_PHONE,`[query user error][invalid phone]: ${t}`);default:return o(500,l.UNEXPECTED,`[query user error][invalid status]: ${n.status}`)}}}catch(n){return console.error(n),o(500,l.UNEXPECTED,"[query user error][unknown error]")}}async query_chat(t){let n,e,s;if(typeof t=="string"){if(n=this.core.Store.Chat.models.find(i=>i.id.user===t),!n){if(w())try{s=this.core.WidFactory.createUserWid(t)}catch(i){return console.error(i),[o(500,l.UNEXPECTED,"[query chat error][create user wid error]")]}else{let i=await this.query_user(t);switch(i.status){case 200:s=i.data;break;case 400:return[o(400,l.INVALID_PHONE,`[query chat error][invalid phone format]: ${t}`)];case 404:return[o(404,l.INVALID_PHONE,`[query chat error][invalid phone]: ${t}`)]}}s&&(n=this.core.Store.Chat.models[0],e=n.id,n.id=s)}}else n=this.core.Store.Chat.models.find(i=>i.id.user===t.user);return[o(200,"","",n),e]}async send_text(t,n){if(!n)return o(400,l.ZERO_OBJECT_SIZE,"[send text error][empty message]");try{let[e,s]=await this.query_chat(t),i;if(e.status===200)i=e.data;else return e;return await window.wapi.SendTextMsgToChat(i,n),s&&(i.id=s),o(200,"","[send text success]")}catch(e){return console.error(e),o(500,l.UNEXPECTED,"[send text error][unknown error]",e)}}async send_media(t,n,e){let s,i;try{let[a,c]=await this.query_chat(t);if(s=a.data,i=c,n.length===0)return o(400,l.ZERO_OBJECT_SIZE,"[send media error][empty message]");let p=[...n.map(y=>({file:y})),n.length],d=new this.core.MediaCollection(s);if(await d.processAttachments(p,s,1),n.length===1)await d.models[0].sendToChat(s,{caption:e?.caption});else for(let y of d.models)await y.sendToChat(s,{caption:null})}catch(a){return console.error(a),o(500,l.UNEXPECTED,"[send media error][process attachments error]")}finally{!!s&&!!i&&(s.id=i)}return o(200,"","[send media success]")}async until_connected(t=100,n=1e4){let e=new Date().getTime();for(;new Date().getTime()-e<n;){if(this.is_connected)return;await m(t)}throw new Error}},H=new G;var f=class{#e;files;constructor(t){this.#e=t,this.files=[]}get kind(){return this.#e.kind}get body(){return this.#e.body}get opts(){return this.#e.opts}static async from(t){let n=new f(t);if(n.opts?.attachments?.length>0)for(let e of n.opts.attachments){let s=await O(e.mimetype,e.body,e.filename);n.files.push(s)}return n}};var b=class{#e;constructor(t){this.#e=t}};var K="1.1.8";var Z=class extends X.EventEmitter{#e;#i=K;#n=g;#s;#t;#a;#o;#r;models={Chat:b,Message:f};constructor(){super();this.#n=g,this.#s=C,this.#t=H,this.#r={messages:{}}}get remote(){let[t,n]=JSON.parse(localStorage.getItem("last-wid")||localStorage.getItem("last-wid-md")||'""').split("@");return t.indexOf(":")>=0&&(t=t.split(":")[0]),t}set session_key(t){this.#e=t}get session_key(){return this.#e}get version(){return this.#i}get ui(){return this.#n}get utils(){return this.#s}get api(){return this.#t}get is_connected(){return this.#t.is_connected}get_session(){if(this.#n.is_beta())return o(500,l.UNEXPECTED,"[get_session error][beta not yet support]","");{let{WAToken1:t,WAToken2:n,WABrowserId:e,WASecretBundle:s}=JSON.parse(JSON.stringify(localStorage));return o(200,"","",{WAToken1:t,WAToken2:n,WABrowserId:e,WASecretBundle:s})}}set_session(t){return this.#n.is_beta()?o(500,l.UNEXPECTED,"[set_session error][beta not yet support]"):(indexedDB.deleteDatabase("wawc"),Object.entries(t).forEach(([n,e])=>localStorage.setItem(n,e)),o(200,"",""))}async cache_message(t){let n=await f.from(t),e=`${new Date().getTime()}-${(Math.random()*1e6).toFixed(0)}`;return this.#r.messages[e]=n,e}async fetch_files(){let t=document.createElement("input");return t.type="file",t.click(),await new Promise(n=>{t.oninput=e=>{let s=e.target;n([...s.files])}})}async send_cache_message(t,n){try{let e=this.#r.messages[n];return e?this.send_message(t,e):o(404,"[send_cache_message error]: invalid message cache id")}catch{return o(500,"[send_cache_message error]: send cache message failed")}}async send_message(t,n,e=3e3){let s;console.log(this);try{switch(n instanceof f?s=n:s=await f.from(n),e&&setTimeout(function(){throw Error("timeout")},e),n.kind){case"text":return await this.#t.send_text(t,n.body);case"media":return await this.#t.send_media(t,s.files,{caption:n.opts.caption});default:return o(400,"invalid message")}}catch{return o(500,"unexpected error")}}},V=new Z;(async()=>(window.wapi={},window.whatsapp=V))();})();
